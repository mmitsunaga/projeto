ALTER TABLE PROC_PARTE_DEBITO ADD LIBERADO_CADIN CHAR(1) DEFAULT 'N' NOT NULL;

ALTER TABLE PROC_PARTE_DEBITO_FISICO ADD LIBERADO_CADIN CHAR(1) DEFAULT 'N' NOT NULL;

CREATE TABLE PROJUDI.PROC_PARTE_DEBITO_FISICO_CADIN (	
	ID_PROC_PARTE_DEBITO_FISICO_CD NUMBER(24,0)   NOT NULL,  
	ID_PROC_PARTE_DEBITO_FISICO    NUMBER(24,0)   NOT NULL, 
	NUMERO_LOTE                    NUMBER(24,0)   NOT NULL, 
	DATA_GERACAO                   DATE           NOT NULL, 
	TIPO_DOCUMENTO                 NUMBER(1)      NOT NULL, 
	NUMERO_DOCUMENTO               NUMBER(14,0)   NOT NULL, 
	NOME_PESSOA                    VARCHAR2(60)   NOT NULL, 
	NUMERO_PROCESSO                VARCHAR2(25)   NOT NULL, 
	NATUREZA_PENDENCIA             NUMBER(2)      NOT NULL, 
	CATEGORIA_PENDENCIA            NUMBER(2)      NOT NULL, 
	DATA_VENCIMENTO_DEBITO         DATE           NOT NULL, 
	VALOR_DEVIDO                   NUMBER(20,2)   NOT NULL,
	MEIO_ENVIO_COMUNICADO          NUMBER(2)      NOT NULL, 
	DATA_ENVIO_COMUNICADO          DATE, 
	DATA_CIENCIA_COMUNICADO        DATE, 
	TIPO_LOGRADOURO                CHAR(3)        NOT NULL, 
	NOME_LOGRADOURO                VARCHAR2(60)   NOT NULL,
	NUMERO_ENDERECO                VARCHAR2(10),
	NUMERO_LOTE_ENDERECO           VARCHAR2(9),
	NUMERO_QUADRA_ENDERECO         VARCHAR2(10),
	DESC_COMPLEMENTO_ENDERECO      VARCHAR2(80)   NOT NULL,
	NOME_BAIRRO                    VARCHAR2(60),	
	CODIGO_CEP                     NUMBER(8,0),
	OBSERVACAO_PENDENCIA           VARCHAR2(150),
CONSTRAINT PROCPARTEDEBITOFISICOCADIN_PK PRIMARY KEY (ID_PROC_PARTE_DEBITO_FISICO_CD),
CONSTRAINT PROCPARTEDEBITOFISICOCADIN_FK FOREIGN KEY (ID_PROC_PARTE_DEBITO_FISICO) REFERENCES PROJUDI.PROC_PARTE_DEBITO_FISICO (ID_PROC_PARTE_DEBITO_FISICO));

CREATE SEQUENCE  PROJUDI.PROCPARTEDEBITOFISICOCADIN_SEQ  MINVALUE 1 MAXVALUE 9999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE  NOORDER  NOCYCLE;

CREATE SEQUENCE  PROJUDI.PROCPARTEDEBFISCADINLOTE_SEQ  MINVALUE 1 MAXVALUE 9999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE  NOORDER  NOCYCLE;

CREATE OR REPLACE TRIGGER PROJUDI.PROCPARTEDEBITOFISICOCADIN_TRG BEFORE INSERT OR UPDATE ON PROC_PARTE_DEBITO_FISICO_CADIN
FOR EACH ROW
DECLARE
v_newVal NUMBER(12) := 0;
v_incval NUMBER(12) := 0;
BEGIN
  IF INSERTING AND :new.ID_PROC_PARTE_DEBITO_FISICO_CD IS NULL THEN
    SELECT  PROCPARTEDEBITOFISICOCADIN_SEQ.NEXTVAL INTO v_newVal FROM DUAL;
    IF v_newVal = 1 THEN
      SELECT NVL(max(ID_PROC_PARTE_DEBITO_FISICO_CD),0) INTO v_newVal FROM PROC_PARTE_DEBITO_FISICO_CADIN;
      v_newVal := v_newVal + 1;
      LOOP
           EXIT WHEN v_incval>=v_newVal;
           SELECT PROCPARTEDEBITOFISICOCADIN_SEQ.nextval INTO v_incval FROM dual;
      END LOOP;
    END IF;    
   :new.ID_PROC_PARTE_DEBITO_FISICO_CD := v_newVal;
  END IF;
END;

ALTER TRIGGER PROJUDI.PROCPARTEDEBITOFISICOCADIN_TRG ENABLE;

CREATE TABLE PROJUDI.PROC_PARTE_DEBITO_CADIN (	
	ID_PROC_PARTE_DEBITO_CD        NUMBER(24,0)   NOT NULL,  
	ID_PROC_PARTE_DEBITO           NUMBER(24,0)   NOT NULL, 
	NUMERO_LOTE                    NUMBER(24,0)   NOT NULL, 
	DATA_GERACAO                   DATE           NOT NULL, 
	TIPO_DOCUMENTO                 NUMBER(1)      NOT NULL, 
	NUMERO_DOCUMENTO               NUMBER(14,0)   NOT NULL, 
	NOME_PESSOA                    VARCHAR2(60)   NOT NULL, 
	NUMERO_PROCESSO                VARCHAR2(25)   NOT NULL, 
	NATUREZA_PENDENCIA             NUMBER(2)      NOT NULL, 
	CATEGORIA_PENDENCIA            NUMBER(2)      NOT NULL, 
	DATA_VENCIMENTO_DEBITO         DATE           NOT NULL, 
	VALOR_DEVIDO                   NUMBER(20,2)   NOT NULL,
	MEIO_ENVIO_COMUNICADO          NUMBER(2)      NOT NULL, 
	DATA_ENVIO_COMUNICADO          DATE, 
	DATA_CIENCIA_COMUNICADO        DATE, 
	TIPO_LOGRADOURO                CHAR(3)        NOT NULL, 
	NOME_LOGRADOURO                VARCHAR2(60)   NOT NULL,
	NUMERO_ENDERECO                VARCHAR2(10),
	NUMERO_LOTE_ENDERECO           VARCHAR2(9),
	NUMERO_QUADRA_ENDERECO         VARCHAR2(10),
	DESC_COMPLEMENTO_ENDERECO      VARCHAR2(80)   NOT NULL,
	NOME_BAIRRO                    VARCHAR2(60),	
	CODIGO_CEP                     NUMBER(8,0),
	OBSERVACAO_PENDENCIA           VARCHAR2(150),
CONSTRAINT PROCPARTEDEBITOCADIN_PK PRIMARY KEY (ID_PROC_PARTE_DEBITO_CD),
CONSTRAINT PROCPARTEDEBITOCADIN_FK FOREIGN KEY (ID_PROC_PARTE_DEBITO) REFERENCES PROJUDI.PROC_PARTE_DEBITO (ID_PROC_PARTE_DEBITO));

CREATE SEQUENCE  PROJUDI.PROCPARTEDEBITOCADIN_SEQ  MINVALUE 1 MAXVALUE 9999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE  NOORDER  NOCYCLE;

CREATE OR REPLACE TRIGGER PROJUDI.PROCPARTEDEBITOCADIN_TRG BEFORE INSERT OR UPDATE ON PROC_PARTE_DEBITO_CADIN
FOR EACH ROW
DECLARE
v_newVal NUMBER(12) := 0;
v_incval NUMBER(12) := 0;
BEGIN
  IF INSERTING AND :new.ID_PROC_PARTE_DEBITO_CD IS NULL THEN
    SELECT  PROCPARTEDEBITOCADIN_SEQ.NEXTVAL INTO v_newVal FROM DUAL;
    IF v_newVal = 1 THEN
      SELECT NVL(max(ID_PROC_PARTE_DEBITO_CD),0) INTO v_newVal FROM PROC_PARTE_DEBITO_CADIN;
      v_newVal := v_newVal + 1;
      LOOP
           EXIT WHEN v_incval>=v_newVal;
           SELECT PROCPARTEDEBITOCADIN_SEQ.nextval INTO v_incval FROM dual;
      END LOOP;
    END IF;    
   :new.ID_PROC_PARTE_DEBITO_CD := v_newVal;
  END IF;
END;

ALTER TRIGGER PROJUDI.PROCPARTEDEBITOCADIN_TRG ENABLE;