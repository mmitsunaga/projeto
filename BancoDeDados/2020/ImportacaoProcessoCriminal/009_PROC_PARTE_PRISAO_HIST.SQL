DROP TABLE PROC_PARTE_PRISAO_HIST;

CREATE TABLE PROJUDI.PROC_PARTE_PRISAO_HIST
(	
   ID_PROC_PARTE_PRISAO_HIST    NUMBER(24,0)       NOT NULL, 
   ID_PROC_PARTE_PRISAO         NUMBER(24,0)       NOT NULL, 
   SEQUENCIA                    NUMBER(4,0)        NULL,
   DATA_EVENTO                  DATE               NULL,
   ID_EVENTO_TIPO               NUMBER(10,0)       NULL,
   DATA_REGISTRO                DATE               NULL,
   NUMERO_DOCUMENTO             NUMBER(10,0)       NULL,
   ID_ARQ_TIPO                  NUMBER(10,0)       NULL,
   MATRICULA_RESPONSAVEL        VARCHAR2(10 CHAR)  NULL,
   OBSERVACAO                   VARCHAR2(255 CHAR) NULL
);

CREATE UNIQUE INDEX PROJUDI.PROC_PARTE_PRISAO_HIST_IDX1 ON PROJUDI.PROC_PARTE_PRISAO_HIST (ID_PROC_PARTE_PRISAO_HIST);

ALTER TABLE PROJUDI.PROC_PARTE_PRISAO_HIST ADD CONSTRAINT PK_PROC_PARTE_PRISAO_HIST PRIMARY KEY(ID_PROC_PARTE_PRISAO_HIST);

CREATE INDEX PROJUDI.PROC_PARTE_PRISAO_HIST_IDX2 ON PROJUDI.PROC_PARTE_PRISAO_HIST (ID_PROC_PARTE_PRISAO);

ALTER TABLE PROJUDI.PROC_PARTE_PRISAO_HIST ADD CONSTRAINT PROCPARTEPHIST_PROCPARTEP_FK FOREIGN KEY (ID_PROC_PARTE_PRISAO) REFERENCES PROJUDI.PROC_PARTE_PRISAO (ID_PROC_PARTE_PRISAO);

CREATE INDEX PROJUDI.PROC_PARTE_PRISAO_HIST_IDX3 ON PROJUDI.PROC_PARTE_PRISAO_HIST (ID_EVENTO_TIPO);

ALTER TABLE PROJUDI.PROC_PARTE_PRISAO_HIST ADD CONSTRAINT PROCPARTEPHIST_EVENTOTIPO_FK FOREIGN KEY (ID_EVENTO_TIPO) REFERENCES PROJUDI.EVENTO_TIPO (ID_EVENTO_TIPO);

CREATE INDEX PROJUDI.PROC_PARTE_PRISAO_HIST_IDX4 ON PROJUDI.PROC_PARTE_PRISAO_HIST (ID_ARQ_TIPO);

ALTER TABLE PROJUDI.PROC_PARTE_PRISAO_HIST ADD CONSTRAINT PROCPARTPRISAOHS_ARQUIVOTP_FK FOREIGN KEY (ID_ARQ_TIPO) REFERENCES PROJUDI.ARQ_TIPO (ID_ARQ_TIPO);

CREATE SEQUENCE  PROJUDI.PROC_PARTE_PRISAO_HIST_ID_SEQ  MINVALUE 1 MAXVALUE 9999999999999999999999 INCREMENT BY 1 START WITH 1 NOCACHE  NOORDER  NOCYCLE;

CREATE OR REPLACE TRIGGER PROJUDI.PROC_PARTE_PRISAO_HIST_ID_TRG BEFORE INSERT OR UPDATE ON PROC_PARTE_PRISAO_HIST
FOR EACH ROW
DECLARE
v_newVal NUMBER(12) := 0;
v_incval NUMBER(12) := 0;
BEGIN
  IF INSERTING AND :new.ID_PROC_PARTE_PRISAO_HIST IS NULL THEN
    SELECT PROC_PARTE_PRISAO_HIST_ID_SEQ.NEXTVAL INTO v_newVal FROM DUAL;
   
   :new.ID_PROC_PARTE_PRISAO_HIST := v_newVal;
  END IF;
END;

ALTER TRIGGER PROJUDI.PROC_PARTE_PRISAO_HIST_ID_TRG ENABLE;

